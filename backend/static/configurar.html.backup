<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Bot - Kairix</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-red-light: #FF5A5A;
            --primary-red-dark: #9A0000;
            --primary-gradient: linear-gradient(135deg, var(--primary-red-light), var(--primary-red-dark));
            --dark-bg: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1e1e1e;
            --text-light: #ffffff;
            --success-green: #00D95F;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            padding: 30px 20px;
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            margin-bottom: 40px;
        }

        .sidebar-header img {
            height: 60px;
            margin-bottom: 10px;
        }

        .sidebar-header h3 {
            font-size: 1.2rem;
            color: var(--primary-red-light);
        }

        .sidebar-header p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .menu-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .menu-item.active {
            background: var(--primary-gradient);
        }

        .menu-item-icon {
            font-size: 1.2rem;
        }

        .menu-item-text {
            flex: 1;
        }

        .menu-item-badge {
            background: var(--success-green);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .menu-item-badge.pending {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 40px;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .content-header p {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #FF5A5A;
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }

        .chart-container {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255,90,90,0.1);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .chart-placeholder {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.3);
        }

        /* Content Section */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .section-card h3 {
            margin-bottom: 20px;
            color: var(--primary-red-light);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group small {
            display: block;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 90, 90, 0.3);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            text-align: left;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Order Card Styles */
        .order-info-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .order-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .order-info-title {
            font-size: 1.5rem;
            color: var(--primary-red-light);
        }

        .order-info-id {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .order-info-price {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .order-detail-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .order-detail-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .order-detail-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Timeline Styles */
        .status-timeline-section {
            margin-top: 30px;
        }

        .timeline-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--primary-red-light);
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }

        .timeline-item:last-child {
            padding-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            left: -32px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid var(--dark-bg);
        }

        .timeline-item.active .timeline-dot {
            background: var(--primary-red-light);
            box-shadow: 0 0 0 4px rgba(255, 90, 90, 0.2);
        }

        .timeline-item.completed .timeline-dot {
            background: var(--success-green);
        }

        .timeline-content {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
        }

        .timeline-status {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-date {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .timeline-notes {
            margin-top: 8px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Modal Meus Dados */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            color: #FF5A5A;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 90, 90, 0.3);
            transform: rotate(90deg);
        }

        .modal-form-group {
            margin-bottom: 20px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .modal-form-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .modal-form-group input:focus {
            outline: none;
            border-color: #FF5A5A;
            background: rgba(255, 255, 255, 0.08);
        }

        .modal-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-required {
            color: #FF5A5A;
        }

        .modal-btn-save {
            width: 100%;
            background: linear-gradient(135deg, #FF5A5A, #9A0000);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .modal-btn-save:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 90, 90, 0.4);
        }

        .modal-btn-save:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .modal-success {
            background: rgba(0, 217, 95, 0.2);
            border: 1px solid rgba(0, 217, 95, 0.5);
            color: #00D95F;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .modal-success.active {
            display: block;
        }

        .modal-error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .modal-error.active {
            display: block;
        }

        /* Bot√£o Hamb√∫rguer Mobile */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10001;
            background: var(--primary-gradient);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            cursor: pointer;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 4px 15px rgba(255, 90, 90, 0.3);
            transition: all 0.3s ease;
        }

        .mobile-menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 90, 90, 0.4);
        }

        .mobile-menu-btn span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .mobile-menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(7px, 7px);
        }

        .mobile-menu-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }

        /* Overlay para Mobile */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }

            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 280px;
                height: 100vh;
                z-index: 9999;
                transition: left 0.3s ease;
                overflow-y: auto;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 80px 20px 20px 20px;
                width: 100%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .order-info-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .timeline {
                padding-left: 30px;
            }

            .timeline-dot {
                left: -27px;
            }

            .modal-content {
                padding: 25px;
                max-width: 95%;
            }

            .modal-form-row {
                grid-template-columns: 1fr;
            }

            .content-header h1 {
                font-size: 1.5rem;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .mobile-menu-btn {
                width: 45px;
                height: 45px;
                top: 15px;
                left: 15px;
            }

            .main-content {
                padding: 70px 15px 15px 15px;
            }

            .sidebar {
                width: 100%;
                left: -100%;
            }

            .sidebar.mobile-open {
                left: 0;
            }
        }

        /* Submenu Mobile */
        .mobile-sidebar nav ul li.has-submenu > a {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .mobile-sidebar nav ul li.has-submenu > a::after {
            content: '‚ñº';
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }

        .mobile-sidebar nav ul li.has-submenu.open > a::after {
            transform: rotate(180deg);
        }

        .mobile-sidebar nav ul li .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding-left: 20px;
        }

        .mobile-sidebar nav ul li.has-submenu.open .submenu {
            max-height: 300px;
            margin-top: 10px;
        }

        .mobile-sidebar nav ul li .submenu a {
            padding: 10px 0;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            border-left: 2px solid rgba(255, 90, 90, 0.3);
            padding-left: 15px;
            margin-bottom: 8px;
        }

        .mobile-sidebar nav ul li .submenu a:hover {
            color: #FF5A5A;
            border-left-color: #FF5A5A;
        }

        /* Sistema de Abas */
        .tabs-container {
            background: rgba(255,255,255,0.03);
            padding: 0 40px;
            display: flex;
            gap: 5px;
            border-bottom: 1px solid rgba(255,90,90,0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            background: transparent;
            border: none;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
        }

        .tab:hover {
            background: rgba(255,255,255,0.05);
        }

        .tab.active {
            border-bottom-color: var(--primary-red-light);
            background: rgba(255,90,90,0.1);
        }

        .tab-content-wrapper {
            display: none;
        }

        .tab-content-wrapper.active {
            display: block;
        }

        /* Ajustar body para comportar as abas */
        body {
            padding-top: 60px;
        }

        @media (max-width: 768px) {
            .tabs-container {
                padding: 0 15px;
                overflow-x: auto;
                white-space: nowrap;
            }

            .tab {
                padding: 12px 18px;
                font-size: 0.85rem;
            }

            body {
                padding-top: 55px;
            }
        }

        /* Formul√°rio Meus Dados Tab */
        .form-container-tab {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        /* Plano Card */
        .plan-card {
            background: linear-gradient(135deg, rgba(255,90,90,0.2), rgba(154,0,0,0.2));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .plan-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 20px;
            margin-bottom: 20px;
        }

        .plan-features {
            list-style: none;
        }

        .plan-features li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .plan-features li::before {
            content: '‚úì ';
            color: var(--success-green);
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Sistema de Abas -->
    <div class="tabs-container">
        <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
        <button class="tab" onclick="showTab('configurar')">‚öôÔ∏è Configurar Bot</button>
        <button class="tab" onclick="showTab('dados')">üë§ Meus Dados</button>
        <button class="tab" onclick="showTab('plano')">üíé Meu Plano</button>
    </div>

    <!-- Bot√£o Menu Mobile -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Overlay Mobile -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="/logo.png" alt="Kairix">
            <h3 id="productName">Carregando...</h3>
            <p id="planName">Carregando...</p>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Vis√£o Geral</div>
            <div class="menu-item active" onclick="showSection('dashboard')">
                <span class="menu-item-icon">üìä</span>
                <span class="menu-item-text">Dashboard</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Configura√ß√µes</div>
            <div class="menu-item active">
                <span class="menu-item-icon">ü§ñ</span>
                <span class="menu-item-text">Configura√ß√£o do Agente</span>
            </div>
            <div class="menu-item" onclick="showSection('respostas')">
                <span class="menu-item-icon">üí¨</span>
                <span class="menu-item-text">Respostas Predefinidas</span>
                <span class="menu-item-badge pending" id="badge-respostas">0</span>
            </div>
            <div class="menu-item" onclick="showSection('menu')">
                <span class="menu-item-icon">üìã</span>
                <span class="menu-item-text">Menu Interativo</span>
                <span class="menu-item-badge pending" id="badge-menu">Pendente</span>
            </div>
            <div class="menu-item" onclick="showSection('fluxos')">
                <span class="menu-item-icon">üîÑ</span>
                <span class="menu-item-text">Fluxos de Conversa</span>
                <span class="menu-item-badge pending" id="badge-fluxos">0</span>
            </div>
            <div class="menu-item" onclick="showSection('integracoes')">
                <span class="menu-item-icon">üîó</span>
                <span class="menu-item-text">Integra√ß√µes</span>
                <span class="menu-item-badge pending" id="badge-integracoes">Pendente</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">A√ß√µes</div>
            <div class="menu-item" onclick="openMyDataModal()">
                <span class="menu-item-icon">üë§</span>
                <span class="menu-item-text">Meus Dados</span>
            </div>
            <div class="menu-item" onclick="openChangePasswordModal()">
                <span class="menu-item-icon">üîí</span>
                <span class="menu-item-text">Alterar Senha</span>
            </div>
            <div class="menu-item" onclick="logout()">
                <span class="menu-item-icon">üö™</span>
                <span class="menu-item-text">Sair do Painel</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- TAB: Dashboard -->
        <div id="tab-dashboard" class="tab-content-wrapper active">
        <!-- Dashboard Section -->
        <div class="content-section active" id="section-dashboard">
            <div class="content-header">
                <h1>Dashboard de Configura√ß√£o</h1>
                <p>Acompanhe o progresso da configura√ß√£o do seu bot</p>
            </div>

            <!-- Cards de Estat√≠sticas -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-value" id="stat-msgs">0</div>
                    <div class="stat-label">Mensagens Hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="stat-contacts">0</div>
                    <div class="stat-label">Contatos Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value">< 1s</div>
                    <div class="stat-label">Tempo Resposta</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value">-</div>
                    <div class="stat-label">Taxa Convers√£o</div>
                </div>
            </div>

            <!-- Gr√°fico de Atividade -->
            <div class="chart-container">
                <div class="chart-title">üìä Atividade de Conversas</div>
                <canvas id="metricsChart" width="400" height="120"></canvas>
            </div>
        </div>

        <!-- Conex√£o WhatsApp Section -->
        <div class="content-section" id="section-conexao">
            <div class="content-header">
                <h1>üì± Conex√£o WhatsApp</h1>
                <p>Configure o n√∫mero onde o bot ser√° instalado</p>
            </div>

            <div class="section-card">
                <h3>Dados de Conex√£o</h3>
                <form id="form-conexao">
                    <div class="form-group">
                        <label>N√∫mero WhatsApp Business *</label>
                        <input type="text" id="numero_whatsapp" placeholder="(65) 99934-2690" required>
                        <small>Este n√∫mero ser√° usado para instalar o bot. Certifique-se que √© uma conta Business.</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Salvar Conex√£o</button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o de Respostas Predefinidas -->
        <div class="content-section" id="section-respostas">
            <div class="content-header">
                <h1>üí¨ Respostas Predefinidas</h1>
                <p>Configure as respostas autom√°ticas do seu bot</p>
            </div>

            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Minhas Respostas</h3>
                    <button class="btn btn-primary" onclick="showRespostaForm()">‚ûï Nova Resposta</button>
                </div>

                <!-- Formul√°rio de Nova/Editar Resposta -->
                <div id="resposta-form" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                    <h4 id="resposta-form-title">Nova Resposta</h4>
                    <form id="form-resposta" onsubmit="saveResposta(event)">
                        <input type="hidden" id="resposta-id">
                        <div class="form-group">
                            <label>Pergunta/Palavra-Chave *</label>
                            <input type="text" id="resposta-pergunta" placeholder="Ex: Hor√°rio de atendimento" required>
                            <small>A pergunta ou palavra-chave que acionar√° esta resposta</small>
                        </div>
                        <div class="form-group">
                            <label>Resposta *</label>
                            <textarea id="resposta-resposta" placeholder="Ex: Nosso atendimento funciona de segunda a sexta, das 8h √†s 18h" required></textarea>
                            <small>A resposta que o bot enviar√° automaticamente</small>
                        </div>
                        <div class="form-group">
                            <label>Palavras-Chave Adicionais (opcional)</label>
                            <input type="text" id="resposta-palavras" placeholder="Ex: hor√°rio, hora, quando, aberto">
                            <small>Palavras separadas por v√≠rgula que tamb√©m acionam esta resposta</small>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-success">üíæ Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideRespostaForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Respostas -->
                <div id="respostas-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <p>Nenhuma resposta cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Resposta" para come√ßar</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Menu Interativo -->
        <div class="content-section" id="section-menu">
            <div class="content-header">
                <h1>üìã Menu Interativo</h1>
                <p>Configure o menu de op√ß√µes que seus clientes ver√£o no WhatsApp</p>
            </div>

            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Op√ß√µes do Menu</h3>
                    <button class="btn btn-primary" onclick="showMenuForm()">‚ûï Nova Op√ß√£o</button>
                </div>

                <!-- Formul√°rio de Nova/Editar Op√ß√£o -->
                <div id="menu-form" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                    <h4 id="menu-form-title">Nova Op√ß√£o de Menu</h4>
                    <form id="form-menu" onsubmit="saveMenu(event)">
                        <input type="hidden" id="menu-id">
                        <div class="form-group">
                            <label>N√∫mero da Op√ß√£o *</label>
                            <input type="text" id="menu-numero" placeholder="Ex: 1" required maxlength="1">
                            <small>N√∫mero de 1 a 9 que o cliente digitar√° para escolher esta op√ß√£o</small>
                        </div>
                        <div class="form-group">
                            <label>T√≠tulo da Op√ß√£o *</label>
                            <input type="text" id="menu-titulo" placeholder="Ex: Falar com Atendente" required>
                            <small>O texto que aparecer√° no menu</small>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o (opcional)</label>
                            <textarea id="menu-descricao" placeholder="Ex: Ser√° transferido para um atendente humano"></textarea>
                            <small>Explica√ß√£o adicional sobre esta op√ß√£o</small>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-success">üíæ Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideMenuForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Op√ß√µes -->
                <div id="menu-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Nenhuma op√ß√£o de menu cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Op√ß√£o" para come√ßar</p>
                    </div>
                </div>
            </div>

            <!-- Preview do Menu -->
            <div class="section-card">
                <h3>üì± Preview do Menu</h3>
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; font-family: monospace;">
                    <div id="menu-preview">
                        <p style="color: rgba(255, 255, 255, 0.6);">O preview do menu aparecer√° aqui ap√≥s adicionar op√ß√µes</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Fluxos de Conversa -->
        <div class="content-section" id="section-fluxos">
            <div class="content-header">
                <h1>üîÑ Fluxos de Conversa</h1>
                <p>Configure fluxos de conversa para diferentes situa√ß√µes</p>
            </div>

            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Meus Fluxos</h3>
                    <button class="btn btn-primary" onclick="showFluxoForm()">‚ûï Novo Fluxo</button>
                </div>

                <!-- Formul√°rio de Novo/Editar Fluxo -->
                <div id="fluxo-form" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                    <h4 id="fluxo-form-title">Novo Fluxo de Conversa</h4>
                    <form id="form-fluxo" onsubmit="saveFluxo(event)">
                        <input type="hidden" id="fluxo-id">
                        <div class="form-group">
                            <label>Nome do Fluxo *</label>
                            <input type="text" id="fluxo-nome" placeholder="Ex: Atendimento Vendas" required>
                            <small>Um nome identificador para este fluxo</small>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <textarea id="fluxo-descricao" placeholder="Ex: Fluxo para atendimento de vendas e or√ßamentos"></textarea>
                            <small>Descreva quando este fluxo deve ser usado</small>
                        </div>
                        <div class="form-group">
                            <label>Etapas do Fluxo (JSON)</label>
                            <textarea id="fluxo-etapas" placeholder='[{"ordem": 1, "mensagem": "Qual produto voc√™ deseja?", "tipo": "pergunta"}]' style="min-height: 150px; font-family: monospace;"></textarea>
                            <small>Configure as etapas do fluxo em formato JSON</small>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-success">üíæ Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideFluxoForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Fluxos -->
                <div id="fluxos-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîÑ</div>
                        <p>Nenhum fluxo de conversa cadastrado ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Novo Fluxo" para come√ßar</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Integra√ß√µes -->
        <div class="content-section" id="section-integracoes">
            <div class="content-header">
                <h1>üîó Integra√ß√µes</h1>
                <p>Configure integra√ß√µes com CRM, gateways de pagamento e outras ferramentas</p>
            </div>

            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Minhas Integra√ß√µes</h3>
                    <button class="btn btn-primary" onclick="showIntegracaoForm()">‚ûï Nova Integra√ß√£o</button>
                </div>

                <!-- Formul√°rio de Nova/Editar Integra√ß√£o -->
                <div id="integracao-form" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                    <h4 id="integracao-form-title">Nova Integra√ß√£o</h4>
                    <form id="form-integracao" onsubmit="saveIntegracao(event)">
                        <input type="hidden" id="integracao-id">
                        <div class="form-group">
                            <label>Tipo de Integra√ß√£o *</label>
                            <select id="integracao-tipo" required>
                                <option value="">Selecione...</option>
                                <option value="crm">CRM</option>
                                <option value="gateway_pagamento">Gateway de Pagamento</option>
                                <option value="erp">ERP</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nome da Integra√ß√£o *</label>
                            <input type="text" id="integracao-nome" placeholder="Ex: RD Station, HubSpot, etc." required>
                            <small>Nome da ferramenta ou sistema que ser√° integrado</small>
                        </div>
                        <div class="form-group">
                            <label>Webhook URL</label>
                            <input type="url" id="integracao-webhook" placeholder="https://api.exemplo.com/webhook">
                            <small>URL do webhook para enviar dados</small>
                        </div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="text" id="integracao-apikey" placeholder="sua-api-key-aqui">
                            <small>Chave de API para autentica√ß√£o</small>
                        </div>
                        <div class="form-group">
                            <label>Documenta√ß√£o / Instru√ß√µes</label>
                            <textarea id="integracao-doc" placeholder="Cole aqui a documenta√ß√£o da API, instru√ß√µes de integra√ß√£o, headers necess√°rios, etc."></textarea>
                            <small>Documenta√ß√£o t√©cnica para implementa√ß√£o da integra√ß√£o</small>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="integracao-ativo" checked>
                                <span>Integra√ß√£o Ativa</span>
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-success">üíæ Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideIntegracaoForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Integra√ß√µes -->
                <div id="integracoes-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîó</div>
                        <p>Nenhuma integra√ß√£o cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Integra√ß√£o" para come√ßar</p>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Fim TAB: Dashboard (Configurar Bot) -->

        <!-- TAB: Configurar Bot (vazio - usa sidebar para navegar) -->
        <div id="tab-configurar" class="tab-content-wrapper">
            <div class="content-header">
                <h1>Configurar Bot</h1>
                <p>Use o menu lateral para acessar as diferentes configura√ß√µes do bot</p>
            </div>
        </div>

        <!-- TAB: Meus Dados -->
        <div id="tab-dados" class="tab-content-wrapper">
            <div class="form-container-tab">
                <h1 style="margin-bottom: 30px;">Meus Dados</h1>

                <div class="form-section">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="tab-edit-name" placeholder="Seu nome">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="tab-edit-email" placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label>Telefone</label>
                        <input type="text" id="tab-edit-phone" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp</label>
                        <input type="text" id="tab-edit-whatsapp" placeholder="(00) 00000-0000">
                    </div>

                    <button class="btn btn-primary" onclick="saveProfileTab()">Salvar Altera√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- TAB: Meu Plano -->
        <div id="tab-plano" class="tab-content-wrapper">
            <div class="form-container-tab">
                <h1 style="margin-bottom: 30px;">Meu Plano</h1>

                <div class="plan-card">
                    <div class="plan-name" id="tab-plan-name">Carregando...</div>
                    <div class="plan-price" id="tab-plan-price">R$ 0,00/m√™s</div>

                    <ul class="plan-features" id="tab-plan-features">
                        <li>Carregando recursos...</li>
                    </ul>
                </div>

                <button class="btn btn-primary" onclick="upgradePlanTab()">Fazer Upgrade do Plano</button>
            </div>
        </div>
    </div>

    <!-- Modal Meus Dados -->
    <div class="modal-overlay" id="myDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Meus Dados</h2>
                <button class="modal-close" onclick="closeMyDataModal()">&times;</button>
            </div>

            <div class="modal-success" id="modalSuccess">
                Dados atualizados com sucesso!
            </div>

            <div class="modal-error" id="modalError"></div>

            <form id="myDataForm">
                <div class="modal-form-group">
                    <label>Nome Completo <span class="modal-required">*</span></label>
                    <input type="text" id="modal-name" name="nome" required>
                </div>

                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label>Email <span class="modal-required">*</span></label>
                        <input type="email" id="modal-email" name="email" required>
                    </div>

                    <div class="modal-form-group">
                        <label>WhatsApp do Agente <span class="modal-required">*</span></label>
                        <input type="tel" id="modal-whatsapp" name="whatsapp" placeholder="(00) 00000-0000" required>
                    </div>
                </div>

                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label>Telefone <span class="modal-required">*</span></label>
                        <input type="tel" id="modal-phone" name="telefone" placeholder="(00) 00000-0000" required>
                    </div>

                    <div class="modal-form-group">
                        <label>CPF/CNPJ</label>
                        <input type="text" id="modal-cpf_cnpj" name="cpf_cnpj" placeholder="000.000.000-00">
                    </div>
                </div>

                <div class="modal-form-group">
                    <label>Nome da Empresa</label>
                    <input type="text" id="modal-company_name" name="nome_empresa">
                </div>

                <div class="modal-form-group">
                    <label>Endere√ßo</label>
                    <input type="text" id="modal-address" name="endereco">
                </div>

                <div class="modal-form-row">
                    <div class="modal-form-group">
                        <label>Cidade</label>
                        <input type="text" id="modal-city" name="cidade">
                    </div>

                    <div class="modal-form-group">
                        <label>Estado</label>
                        <input type="text" id="modal-state" name="estado" maxlength="2" placeholder="EX: SP">
                    </div>
                </div>

                <div class="modal-form-group">
                    <label>CEP</label>
                    <input type="text" id="modal-zipcode" name="cep" placeholder="00000-000">
                </div>

                <button type="submit" class="modal-btn-save" id="modalSaveBtn">
                    Salvar Altera√ß√µes
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Alterar Senha -->
    <div class="modal-overlay" id="changePasswordModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üîí Alterar Senha</h2>
                <button class="modal-close" onclick="closeChangePasswordModal()">&times;</button>
            </div>

            <div class="modal-success" id="passwordModalSuccess">
                Senha alterada com sucesso!
            </div>

            <div class="modal-error" id="passwordModalError"></div>

            <form id="changePasswordForm">
                <div class="modal-form-group">
                    <label>Senha Atual <span class="modal-required">*</span></label>
                    <input type="password" id="current-password" name="current_password" required minlength="6">
                </div>

                <div class="modal-form-group">
                    <label>Nova Senha <span class="modal-required">*</span></label>
                    <input type="password" id="new-password" name="new_password" required minlength="6" placeholder="M√≠nimo 6 caracteres">
                </div>

                <div class="modal-form-group">
                    <label>Confirmar Nova Senha <span class="modal-required">*</span></label>
                    <input type="password" id="confirm-password" name="confirm_password" required minlength="6" placeholder="Digite a nova senha novamente">
                </div>

                <button type="submit" class="modal-btn-save" id="passwordSaveBtn">
                    Alterar Senha
                </button>
            </form>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // Obter par√¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order');
        const agentType = urlParams.get('type');
        const planName = urlParams.get('plan');

        // Configura√ß√£o global
        let currentConfig = {};
        let currentClientId = null;  // Armazenar o client_id

        // Inicializar p√°gina
        async function init() {
            // Verificar se h√° orderId nos par√¢metros da URL
            if (!orderId) {
                console.warn('Nenhum pedido especificado. Redirecionando para login.');
                window.location.href = '/login';
                return;
            }

            document.getElementById('productName').textContent = getProductName(agentType);
            document.getElementById('planName').textContent = planName;

            // Buscar client_id do pedido
            try {
                console.log('Buscando pedido:', orderId);
                const orderResponse = await fetch(`/api/orders/${orderId}`);
                console.log('Response status:', orderResponse.status);
                if (orderResponse.ok) {
                    const order = await orderResponse.json();
                    console.log('Pedido completo:', order);
                    currentClientId = order.cliente_id;
                    console.log('currentClientId definido como:', currentClientId);

                    // Verificar se cliente est√° ativo
                    if (!order.cliente_ativo) {
                        console.warn('Cliente inativo. Redirecionando para login.');
                        window.location.href = '/login';
                        return;
                    }
                } else {
                    console.warn('Pedido n√£o encontrado. Redirecionando para login.');
                    window.location.href = '/login';
                    return;
                }
            } catch (error) {
                console.error('Erro ao buscar dados do pedido:', error);
                console.warn('Redirecionando para login devido ao erro.');
                window.location.href = '/login';
                return;
            }

            // await loadOrderData(); // Removido - card de pedido n√£o existe mais
            await loadConfiguration();
            // updateDashboard(); // Removido - cards de progresso n√£o existem mais
        }

        // Carregar dados do pedido
        async function loadOrderData() {
            try {
                // Buscar dados do pedido
                const orderResponse = await fetch(`/api/orders/${orderId}`);
                if (!orderResponse.ok) throw new Error('Pedido n√£o encontrado');
                const order = await orderResponse.json();

                // Buscar hist√≥rico do pedido
                const historyResponse = await fetch(`/api/orders/${orderId}/history`);
                const history = historyResponse.ok ? await historyResponse.json() : [];

                // Atualizar informa√ß√µes do pedido
                const statusMap = {
                    'cadastro_feito': 'Cadastro Feito',
                    'aguardando_pagamento': 'Aguardando Pagamento',
                    'pagamento_aprovado': 'Pagamento Aprovado',
                    'configurando_ambiente': 'Configurando Ambiente',
                    'instalando_agente': 'Instalando Agente',
                    'concluido': 'Conclu√≠do',
                    'cancelado': 'Cancelado'
                };

                document.getElementById('order-title').textContent = `${getProductName(agentType)} - ${planName}`;
                document.getElementById('order-id').textContent = `Pedido #${order.id}`;
                document.getElementById('order-price').textContent = `R$ ${order.total.toFixed(2).replace('.', ',')}`;
                document.getElementById('order-status').textContent = statusMap[order.status] || order.status;
                document.getElementById('order-date').textContent = new Date(order.criado_em).toLocaleDateString('pt-BR');

                // Mostrar data de pagamento se existir
                if (order.data_pagamento) {
                    document.getElementById('payment-date-container').style.display = 'block';
                    document.getElementById('order-payment-date').textContent = new Date(order.data_pagamento).toLocaleDateString('pt-BR');
                }

                // Renderizar timeline
                renderTimeline(history, order.status);

            } catch (error) {
                console.error('Erro ao carregar dados do pedido:', error);
                document.getElementById('order-timeline').innerHTML = '<p style="color: #ff6b6b;">Erro ao carregar hist√≥rico do pedido.</p>';
            }
        }

        function renderTimeline(history, currentStatus) {
            const allStatuses = [
                'cadastro_feito',
                'aguardando_pagamento',
                'pagamento_aprovado',
                'configurando_ambiente',
                'instalando_agente',
                'concluido'
            ];

            const statusLabels = {
                'cadastro_feito': 'Cadastro Realizado',
                'aguardando_pagamento': 'Aguardando Pagamento',
                'pagamento_aprovado': 'Pagamento Aprovado',
                'configurando_ambiente': 'Configurando Ambiente',
                'instalando_agente': 'Instalando Agente',
                'concluido': 'Conclu√≠do'
            };

            const currentIndex = allStatuses.indexOf(currentStatus);
            let timelineHTML = '';

            allStatuses.forEach((status, index) => {
                const historyItem = history.find(h => h.status === status);
                const isCompleted = index < currentIndex;
                const isActive = index === currentIndex;
                const className = isCompleted ? 'completed' : (isActive ? 'active' : '');

                timelineHTML += `
                    <div class="timeline-item ${className}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-status">${statusLabels[status]}</div>
                            ${historyItem ? `
                                <div class="timeline-date">${new Date(historyItem.criado_em).toLocaleString('pt-BR')}</div>
                                ${historyItem.observacoes ? `<div class="timeline-notes">${historyItem.observacoes}</div>` : ''}
                            ` : `
                                <div class="timeline-date">${isActive || isCompleted ? 'Em andamento' : 'Pendente'}</div>
                            `}
                        </div>
                    </div>
                `;
            });

            document.getElementById('order-timeline').innerHTML = timelineHTML;
        }

        function getProductName(type) {
            const names = {
                'agente_normal': 'Agente Normal',
                'agente_ia': 'Agente com IA',
                'agente_financeiro': 'Agente Financeiro'
            };
            return names[type] || 'Agente';
        }

        function getClientId() {
            // Pegar do sessionStorage ou localStorage
            return localStorage.getItem('client_id');
        }

        async function loadConfiguration() {
            try {
                const response = await fetch(`/api/config/${orderId}`);
                const data = await response.json();
                currentConfig = data.configuracao || {};

                // Preencher campos
                if (currentConfig.numero_whatsapp) {
                    document.getElementById('numero_whatsapp').value = currentConfig.numero_whatsapp;
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√£o:', error);
            }
        }

        function showSection(sectionName) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remover active de todos os menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // Mostrar se√ß√£o selecionada
            document.getElementById(`section-${sectionName}`).classList.add('active');

            // Ativar menu item
            event.currentTarget.classList.add('active');
        }

        function updateDashboard() {
            // Calcular progresso
            let progress = 0;
            let totalSteps = 5;
            let completedSteps = 0;

            if (currentConfig.numero_whatsapp) completedSteps++;
            if (currentConfig.respostas && currentConfig.respostas.length > 0) completedSteps++;
            if (currentConfig.menu_criado) completedSteps++;
            if (currentConfig.fluxos && currentConfig.fluxos.length > 0) completedSteps++;
            if (currentConfig.integracoes_configuradas) completedSteps++;

            progress = Math.round((completedSteps / totalSteps) * 100);

            document.getElementById('progress-percentage').textContent = progress + '%';
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // Form handlers
        document.getElementById('form-conexao').addEventListener('submit', async (e) => {
            e.preventDefault();

            currentConfig.numero_whatsapp = document.getElementById('numero_whatsapp').value;

            await saveConfiguration();
            alert('‚úÖ Conex√£o WhatsApp salva com sucesso!');
            updateBadge('conexao', 'Configurado');
            updateDashboard();
        });

        async function saveConfiguration() {
            try {
                const response = await fetch(`/api/config/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ configuracao: currentConfig })
                });

                if (!response.ok) {
                    throw new Error('Erro ao salvar');
                }
            } catch (error) {
                console.error('Erro:', error);
                throw error;
            }
        }

        function updateBadge(section, text) {
            const badge = document.getElementById(`badge-${section}`);
            if (badge) {
                badge.textContent = text;
                badge.classList.remove('pending');
            }
        }

        // ============= RESPOSTAS PREDEFINIDAS =============
        let respostas = [];

        async function loadRespostas() {
            try {
                const response = await fetch(`/api/config/${orderId}/respostas`);
                const data = await response.json();
                // A API retorna direto um array, n√£o um objeto com propriedade respostas
                respostas = Array.isArray(data) ? data : (data.respostas || []);
                console.log('Respostas carregadas:', respostas.length);
                renderRespostas();
                updateBadge('respostas', respostas.length);
                document.getElementById('total-respostas').textContent = respostas.length;
            } catch (error) {
                console.error('Erro ao carregar respostas:', error);
            }
        }

        function renderRespostas() {
            const container = document.getElementById('respostas-list');

            if (respostas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <p>Nenhuma resposta cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Resposta" para come√ßar</p>
                    </div>
                `;
                return;
            }

            let html = '<table class="data-table"><thead><tr><th>Pergunta</th><th>Resposta</th><th>Palavras-Chave</th><th>A√ß√µes</th></tr></thead><tbody>';

            respostas.forEach(resposta => {
                const palavras = resposta.palavras_chave && resposta.palavras_chave.length > 0
                    ? resposta.palavras_chave.join(', ')
                    : '-';

                html += `
                    <tr>
                        <td style="font-weight: 600;">${resposta.pergunta}</td>
                        <td>${resposta.resposta.substring(0, 100)}${resposta.resposta.length > 100 ? '...' : ''}</td>
                        <td style="color: rgba(255, 255, 255, 0.6);">${palavras}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-secondary" onclick="editResposta(${resposta.id})">‚úèÔ∏è</button>
                                <button class="btn btn-icon btn-secondary" onclick="deleteResposta(${resposta.id})" style="background: rgba(255, 0, 0, 0.2);">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showRespostaForm() {
            document.getElementById('resposta-form').style.display = 'block';
            document.getElementById('resposta-form-title').textContent = 'Nova Resposta';
            document.getElementById('form-resposta').reset();
            document.getElementById('resposta-id').value = '';
        }

        function hideRespostaForm() {
            document.getElementById('resposta-form').style.display = 'none';
            document.getElementById('form-resposta').reset();
        }

        function editResposta(id) {
            const resposta = respostas.find(r => r.id === id);
            if (!resposta) return;

            document.getElementById('resposta-form').style.display = 'block';
            document.getElementById('resposta-form-title').textContent = 'Editar Resposta';
            document.getElementById('resposta-id').value = resposta.id;
            document.getElementById('resposta-pergunta').value = resposta.pergunta;
            document.getElementById('resposta-resposta').value = resposta.resposta;
            document.getElementById('resposta-palavras').value = resposta.palavras_chave.join(', ');

            // Scroll para o formul√°rio
            document.getElementById('resposta-form').scrollIntoView({ behavior: 'smooth' });
        }

        async function saveResposta(event) {
            event.preventDefault();

            const id = document.getElementById('resposta-id').value;
            const pergunta = document.getElementById('resposta-pergunta').value;
            const respostaText = document.getElementById('resposta-resposta').value;
            const palavrasText = document.getElementById('resposta-palavras').value;

            const palavrasChave = palavrasText
                ? palavrasText.split(',').map(p => p.trim()).filter(p => p)
                : [];

            const data = {
                pergunta,
                resposta: respostaText,
                palavras_chave: palavrasChave
            };

            try {
                let response;
                if (id) {
                    // Editar
                    data.id = parseInt(id);
                    response = await fetch(`/api/config/${orderId}/respostas/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    // Criar
                    response = await fetch(`/api/config/${orderId}/respostas`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                if (!response.ok) throw new Error('Erro ao salvar resposta');

                alert('‚úÖ Resposta salva com sucesso!');
                hideRespostaForm();
                await loadRespostas();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao salvar resposta. Tente novamente.');
            }
        }

        async function deleteResposta(id) {
            if (!confirm('Tem certeza que deseja deletar esta resposta?')) return;

            try {
                const response = await fetch(`/api/config/${orderId}/respostas/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Erro ao deletar resposta');

                alert('‚úÖ Resposta deletada com sucesso!');
                await loadRespostas();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao deletar resposta. Tente novamente.');
            }
        }

        // ============= MENU INTERATIVO =============
        let menuOpcoes = [];

        async function loadMenu() {
            try {
                const response = await fetch(`/api/config/${orderId}/menu`);
                const data = await response.json();
                // A API retorna direto um array, n√£o um objeto com propriedade menu
                menuOpcoes = Array.isArray(data) ? data : (data.menu || []);
                console.log('Menu carregado:', menuOpcoes.length, 'op√ß√µes');
                renderMenu();
                updateMenuPreview();
                updateBadge('menu', menuOpcoes.length > 0 ? 'Configurado' : 'Pendente');
                document.getElementById('total-menu').textContent = menuOpcoes.length;
            } catch (error) {
                console.error('Erro ao carregar menu:', error);
            }
        }

        function renderMenu() {
            const container = document.getElementById('menu-list');

            if (menuOpcoes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Nenhuma op√ß√£o de menu cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Op√ß√£o" para come√ßar</p>
                    </div>
                `;
                return;
            }

            // Ordenar por n√∫mero
            menuOpcoes.sort((a, b) => a.numero.localeCompare(b.numero));

            let html = '<table class="data-table"><thead><tr><th>N¬∫</th><th>T√≠tulo</th><th>Descri√ß√£o</th><th>A√ß√µes</th></tr></thead><tbody>';

            menuOpcoes.forEach(opcao => {
                html += `
                    <tr>
                        <td style="font-weight: 700; font-size: 1.2rem; color: var(--primary-red-light);">${opcao.numero}</td>
                        <td style="font-weight: 600;">${opcao.titulo}</td>
                        <td style="color: rgba(255, 255, 255, 0.6);">${opcao.descricao || '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-secondary" onclick="editMenu(${opcao.id})">‚úèÔ∏è</button>
                                <button class="btn btn-icon btn-secondary" onclick="deleteMenu(${opcao.id})" style="background: rgba(255, 0, 0, 0.2);">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateMenuPreview() {
            const preview = document.getElementById('menu-preview');

            if (menuOpcoes.length === 0) {
                preview.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6);">O preview do menu aparecer√° aqui ap√≥s adicionar op√ß√µes</p>';
                return;
            }

            let previewHTML = '<p style="color: #00D95F; margin-bottom: 15px;">üì± Ol√°! Como posso ajudar voc√™ hoje?</p>';
            previewHTML += '<p style="margin-bottom: 10px;">Escolha uma op√ß√£o:</p>';

            menuOpcoes.sort((a, b) => a.numero.localeCompare(b.numero)).forEach(opcao => {
                previewHTML += `<p style="margin: 8px 0;">`;
                previewHTML += `<strong>${opcao.numero}</strong> - ${opcao.titulo}`;
                if (opcao.descricao) {
                    previewHTML += `<br/><span style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; margin-left: 20px;">${opcao.descricao}</span>`;
                }
                previewHTML += `</p>`;
            });

            preview.innerHTML = previewHTML;
        }

        function showMenuForm() {
            document.getElementById('menu-form').style.display = 'block';
            document.getElementById('menu-form-title').textContent = 'Nova Op√ß√£o de Menu';
            document.getElementById('form-menu').reset();
            document.getElementById('menu-id').value = '';
        }

        function hideMenuForm() {
            document.getElementById('menu-form').style.display = 'none';
            document.getElementById('form-menu').reset();
        }

        function editMenu(id) {
            const opcao = menuOpcoes.find(m => m.id === id);
            if (!opcao) return;

            document.getElementById('menu-form').style.display = 'block';
            document.getElementById('menu-form-title').textContent = 'Editar Op√ß√£o de Menu';
            document.getElementById('menu-id').value = opcao.id;
            document.getElementById('menu-numero').value = opcao.numero;
            document.getElementById('menu-titulo').value = opcao.titulo;
            document.getElementById('menu-descricao').value = opcao.descricao || '';

            document.getElementById('menu-form').scrollIntoView({ behavior: 'smooth' });
        }

        async function saveMenu(event) {
            event.preventDefault();

            const id = document.getElementById('menu-id').value;
            const numero = document.getElementById('menu-numero').value;
            const titulo = document.getElementById('menu-titulo').value;
            const descricao = document.getElementById('menu-descricao').value;

            // Validar n√∫mero (1-9)
            if (!/^[1-9]$/.test(numero)) {
                alert('‚ùå O n√∫mero deve ser entre 1 e 9');
                return;
            }

            // Verificar se o n√∫mero j√° existe (exceto se for edi√ß√£o do mesmo item)
            const numeroExiste = menuOpcoes.some(m => m.numero === numero && m.id != id);
            if (numeroExiste) {
                alert('‚ùå J√° existe uma op√ß√£o com este n√∫mero. Escolha outro n√∫mero.');
                return;
            }

            const data = {
                numero,
                titulo,
                descricao: descricao || null
            };

            try {
                let response;
                if (id) {
                    // Editar
                    data.id = parseInt(id);
                    response = await fetch(`/api/config/${orderId}/menu/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    // Criar
                    response = await fetch(`/api/config/${orderId}/menu`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                if (!response.ok) throw new Error('Erro ao salvar op√ß√£o');

                alert('‚úÖ Op√ß√£o de menu salva com sucesso!');
                hideMenuForm();
                await loadMenu();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao salvar op√ß√£o. Tente novamente.');
            }
        }

        async function deleteMenu(id) {
            if (!confirm('Tem certeza que deseja deletar esta op√ß√£o?')) return;

            try {
                const response = await fetch(`/api/config/${orderId}/menu/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Erro ao deletar op√ß√£o');

                alert('‚úÖ Op√ß√£o deletada com sucesso!');
                await loadMenu();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao deletar op√ß√£o. Tente novamente.');
            }
        }

        // ============= FLUXOS DE CONVERSA =============
        let fluxos = [];

        async function loadFluxos() {
            try {
                const response = await fetch(`/api/config/${orderId}/fluxos`);
                const data = await response.json();
                // A API retorna direto um array, n√£o um objeto com propriedade fluxos
                fluxos = Array.isArray(data) ? data : (data.fluxos || []);
                console.log('Fluxos carregados:', fluxos.length);
                renderFluxos();
                updateBadge('fluxos', fluxos.length);
                document.getElementById('total-fluxos').textContent = fluxos.length;
            } catch (error) {
                console.error('Erro ao carregar fluxos:', error);
            }
        }

        function renderFluxos() {
            const container = document.getElementById('fluxos-list');

            if (fluxos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîÑ</div>
                        <p>Nenhum fluxo de conversa cadastrado ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Novo Fluxo" para come√ßar</p>
                    </div>
                `;
                return;
            }

            let html = '<table class="data-table"><thead><tr><th>Nome</th><th>Descri√ß√£o</th><th>Etapas</th><th>A√ß√µes</th></tr></thead><tbody>';

            fluxos.forEach(fluxo => {
                const numEtapas = fluxo.etapas && Array.isArray(fluxo.etapas) ? fluxo.etapas.length : 0;

                html += `
                    <tr>
                        <td style="font-weight: 600;">${fluxo.nome}</td>
                        <td style="color: rgba(255, 255, 255, 0.6);">${fluxo.descricao || '-'}</td>
                        <td><span style="background: var(--primary-gradient); padding: 4px 12px; border-radius: 15px; font-size: 0.9rem;">${numEtapas} etapas</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-secondary" onclick="editFluxo(${fluxo.id})">‚úèÔ∏è</button>
                                <button class="btn btn-icon btn-secondary" onclick="deleteFluxo(${fluxo.id})" style="background: rgba(255, 0, 0, 0.2);">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showFluxoForm() {
            document.getElementById('fluxo-form').style.display = 'block';
            document.getElementById('fluxo-form-title').textContent = 'Novo Fluxo de Conversa';
            document.getElementById('form-fluxo').reset();
            document.getElementById('fluxo-id').value = '';
            document.getElementById('fluxo-etapas').value = '[]';
        }

        function hideFluxoForm() {
            document.getElementById('fluxo-form').style.display = 'none';
            document.getElementById('form-fluxo').reset();
        }

        function editFluxo(id) {
            const fluxo = fluxos.find(f => f.id === id);
            if (!fluxo) return;

            document.getElementById('fluxo-form').style.display = 'block';
            document.getElementById('fluxo-form-title').textContent = 'Editar Fluxo de Conversa';
            document.getElementById('fluxo-id').value = fluxo.id;
            document.getElementById('fluxo-nome').value = fluxo.nome;
            document.getElementById('fluxo-descricao').value = fluxo.descricao || '';
            document.getElementById('fluxo-etapas').value = JSON.stringify(fluxo.etapas || [], null, 2);

            document.getElementById('fluxo-form').scrollIntoView({ behavior: 'smooth' });
        }

        async function saveFluxo(event) {
            event.preventDefault();

            const id = document.getElementById('fluxo-id').value;
            const nome = document.getElementById('fluxo-nome').value;
            const descricao = document.getElementById('fluxo-descricao').value;
            const etapasText = document.getElementById('fluxo-etapas').value;

            // Validar JSON das etapas
            let etapas = [];
            try {
                etapas = JSON.parse(etapasText || '[]');
                if (!Array.isArray(etapas)) {
                    throw new Error('Etapas deve ser um array');
                }
            } catch (e) {
                alert('‚ùå JSON inv√°lido nas etapas. Verifique a sintaxe.');
                return;
            }

            const data = {
                nome,
                descricao: descricao || null,
                etapas
            };

            try {
                let response;
                if (id) {
                    // Editar
                    data.id = parseInt(id);
                    response = await fetch(`/api/config/${orderId}/fluxos/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    // Criar
                    response = await fetch(`/api/config/${orderId}/fluxos`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                if (!response.ok) throw new Error('Erro ao salvar fluxo');

                alert('‚úÖ Fluxo salvo com sucesso!');
                hideFluxoForm();
                await loadFluxos();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao salvar fluxo. Tente novamente.');
            }
        }

        async function deleteFluxo(id) {
            if (!confirm('Tem certeza que deseja deletar este fluxo?')) return;

            try {
                const response = await fetch(`/api/config/${orderId}/fluxos/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Erro ao deletar fluxo');

                alert('‚úÖ Fluxo deletado com sucesso!');
                await loadFluxos();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao deletar fluxo. Tente novamente.');
            }
        }

        // ============= INTEGRA√á√ïES =============
        let integracoes = [];

        async function loadIntegracoes() {
            try {
                const response = await fetch(`/api/config/${orderId}/integracoes`);
                const data = await response.json();
                // A API retorna direto um array, n√£o um objeto com propriedade integracoes
                integracoes = Array.isArray(data) ? data : (data.integracoes || []);
                console.log('Integra√ß√µes carregadas:', integracoes.length);
                renderIntegracoes();
                const ativas = integracoes.filter(i => i.ativo).length;
                updateBadge('integracoes', ativas > 0 ? `${ativas} ativa(s)` : 'Pendente');
            } catch (error) {
                console.error('Erro ao carregar integra√ß√µes:', error);
            }
        }

        function renderIntegracoes() {
            const container = document.getElementById('integracoes-list');

            if (integracoes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîó</div>
                        <p>Nenhuma integra√ß√£o cadastrada ainda</p>
                        <p style="font-size: 0.9rem;">Clique em "Nova Integra√ß√£o" para come√ßar</p>
                    </div>
                `;
                return;
            }

            let html = '<table class="data-table"><thead><tr><th>Tipo</th><th>Nome</th><th>Webhook</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>';

            integracoes.forEach(integracao => {
                const tipoLabel = {
                    'crm': 'CRM',
                    'gateway_pagamento': 'Gateway Pagamento',
                    'erp': 'ERP',
                    'outro': 'Outro'
                };

                const statusStyle = integracao.ativo
                    ? 'background: rgba(0, 217, 95, 0.2); color: #00D95F;'
                    : 'background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.5);';

                html += `
                    <tr>
                        <td><span style="background: var(--primary-gradient); padding: 4px 12px; border-radius: 15px; font-size: 0.85rem;">${tipoLabel[integracao.tipo] || integracao.tipo}</span></td>
                        <td style="font-weight: 600;">${integracao.nome}</td>
                        <td style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem;">${integracao.webhook_url ? '‚úì Configurado' : '-'}</td>
                        <td><span style="${statusStyle} padding: 4px 12px; border-radius: 15px; font-size: 0.85rem;">${integracao.ativo ? '‚úì Ativa' : 'Inativa'}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-secondary" onclick="editIntegracao(${integracao.id})">‚úèÔ∏è</button>
                                <button class="btn btn-icon btn-secondary" onclick="deleteIntegracao(${integracao.id})" style="background: rgba(255, 0, 0, 0.2);">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showIntegracaoForm() {
            document.getElementById('integracao-form').style.display = 'block';
            document.getElementById('integracao-form-title').textContent = 'Nova Integra√ß√£o';
            document.getElementById('form-integracao').reset();
            document.getElementById('integracao-id').value = '';
            document.getElementById('integracao-ativo').checked = true;
        }

        function hideIntegracaoForm() {
            document.getElementById('integracao-form').style.display = 'none';
            document.getElementById('form-integracao').reset();
        }

        function editIntegracao(id) {
            const integracao = integracoes.find(i => i.id === id);
            if (!integracao) return;

            document.getElementById('integracao-form').style.display = 'block';
            document.getElementById('integracao-form-title').textContent = 'Editar Integra√ß√£o';
            document.getElementById('integracao-id').value = integracao.id;
            document.getElementById('integracao-tipo').value = integracao.tipo;
            document.getElementById('integracao-nome').value = integracao.nome;
            document.getElementById('integracao-webhook').value = integracao.webhook_url || '';
            document.getElementById('integracao-apikey').value = integracao.api_key || '';
            document.getElementById('integracao-doc').value = integracao.documentacao || '';
            document.getElementById('integracao-ativo').checked = integracao.ativo;

            document.getElementById('integracao-form').scrollIntoView({ behavior: 'smooth' });
        }

        async function saveIntegracao(event) {
            event.preventDefault();

            const id = document.getElementById('integracao-id').value;
            const tipo = document.getElementById('integracao-tipo').value;
            const nome = document.getElementById('integracao-nome').value;
            const webhook_url = document.getElementById('integracao-webhook').value || null;
            const api_key = document.getElementById('integracao-apikey').value || null;
            const documentacao = document.getElementById('integracao-doc').value || null;
            const ativo = document.getElementById('integracao-ativo').checked;

            const data = {
                tipo,
                nome,
                webhook_url,
                api_key,
                documentacao,
                ativo
            };

            try {
                let response;
                if (id) {
                    // Editar
                    data.id = parseInt(id);
                    response = await fetch(`/api/config/${orderId}/integracoes/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    // Criar
                    response = await fetch(`/api/config/${orderId}/integracoes`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                if (!response.ok) throw new Error('Erro ao salvar integra√ß√£o');

                alert('‚úÖ Integra√ß√£o salva com sucesso!');
                hideIntegracaoForm();
                await loadIntegracoes();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao salvar integra√ß√£o. Tente novamente.');
            }
        }

        async function deleteIntegracao(id) {
            if (!confirm('Tem certeza que deseja deletar esta integra√ß√£o?')) return;

            try {
                const response = await fetch(`/api/config/${orderId}/integracoes/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Erro ao deletar integra√ß√£o');

                alert('‚úÖ Integra√ß√£o deletada com sucesso!');
                await loadIntegracoes();
                updateDashboard();
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao deletar integra√ß√£o. Tente novamente.');
            }
        }

        // Fun√ß√µes do Modal Meus Dados
        let currentClientData = null;

        async function openMyDataModal() {
            const modal = document.getElementById('myDataModal');
            modal.classList.add('active');

            // Buscar dados do cliente
            try {
                const response = await fetch(`/api/clients/${currentClientId}`);
                if (!response.ok) throw new Error('Erro ao buscar dados do cliente');

                currentClientData = await response.json();

                // Preencher formul√°rio com dados atuais
                document.getElementById('modal-name').value = currentClientData.nome || '';
                document.getElementById('modal-email').value = currentClientData.email || '';
                document.getElementById('modal-whatsapp').value = currentClientData.whatsapp || '';
                document.getElementById('modal-phone').value = currentClientData.telefone || '';
                document.getElementById('modal-cpf_cnpj').value = currentClientData.cpf_cnpj || '';
                document.getElementById('modal-company_name').value = currentClientData.nome_empresa || '';
                document.getElementById('modal-address').value = currentClientData.endereco || '';
                document.getElementById('modal-city').value = currentClientData.cidade || '';
                document.getElementById('modal-state').value = currentClientData.estado || '';
                document.getElementById('modal-zipcode').value = currentClientData.cep || '';

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showModalError('Erro ao carregar seus dados. Tente novamente.');
            }
        }

        function closeMyDataModal() {
            const modal = document.getElementById('myDataModal');
            modal.classList.remove('active');
            hideModalMessages();
        }

        function showModalSuccess() {
            const success = document.getElementById('modalSuccess');
            success.classList.add('active');
            setTimeout(() => {
                success.classList.remove('active');
            }, 3000);
        }

        function showModalError(message) {
            const error = document.getElementById('modalError');
            error.textContent = message;
            error.classList.add('active');
            setTimeout(() => {
                error.classList.remove('active');
            }, 5000);
        }

        function hideModalMessages() {
            document.getElementById('modalSuccess').classList.remove('active');
            document.getElementById('modalError').classList.remove('active');
        }

        // Submeter formul√°rio de Meus Dados
        document.getElementById('myDataForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const saveBtn = document.getElementById('modalSaveBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Salvando...';

            hideModalMessages();

            try {
                const formData = {
                    nome: document.getElementById('modal-name').value,
                    email: document.getElementById('modal-email').value,
                    whatsapp: document.getElementById('modal-whatsapp').value,
                    telefone: document.getElementById('modal-phone').value,
                    cpf_cnpj: document.getElementById('modal-cpf_cnpj').value || null,
                    nome_empresa: document.getElementById('modal-company_name').value || null,
                    endereco: document.getElementById('modal-address').value || null,
                    cidade: document.getElementById('modal-city').value || null,
                    estado: document.getElementById('modal-state').value || null,
                    cep: document.getElementById('modal-zipcode').value || null
                };

                const response = await fetch(`/api/clients/${currentClientId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao salvar dados');
                }

                showModalSuccess();

                // Fechar modal ap√≥s 1.5 segundos
                setTimeout(() => {
                    closeMyDataModal();
                }, 1500);

            } catch (error) {
                console.error('Erro ao salvar:', error);
                showModalError(error.message || 'Erro ao salvar dados. Tente novamente.');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Salvar Altera√ß√µes';
            }
        });

        // Fechar modal ao clicar fora
        document.getElementById('myDataModal').addEventListener('click', (e) => {
            if (e.target.id === 'myDataModal') {
                closeMyDataModal();
            }
        });

        // Fun√ß√µes do Modal Alterar Senha
        function openChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.add('active');
            hidePasswordModalMessages();
            document.getElementById('changePasswordForm').reset();
        }

        function closeChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.remove('active');
            hidePasswordModalMessages();
            document.getElementById('changePasswordForm').reset();
        }

        function showPasswordModalSuccess() {
            const success = document.getElementById('passwordModalSuccess');
            success.classList.add('active');
            setTimeout(() => {
                success.classList.remove('active');
            }, 3000);
        }

        function showPasswordModalError(message) {
            const error = document.getElementById('passwordModalError');
            error.textContent = message;
            error.classList.add('active');
            setTimeout(() => {
                error.classList.remove('active');
            }, 5000);
        }

        function hidePasswordModalMessages() {
            document.getElementById('passwordModalSuccess').classList.remove('active');
            document.getElementById('passwordModalError').classList.remove('active');
        }

        // Submeter formul√°rio de Alterar Senha
        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Validar se as senhas conferem
            if (newPassword !== confirmPassword) {
                showPasswordModalError('As senhas n√£o conferem!');
                return;
            }

            // Validar tamanho m√≠nimo
            if (newPassword.length < 6) {
                showPasswordModalError('A nova senha deve ter no m√≠nimo 6 caracteres!');
                return;
            }

            const saveBtn = document.getElementById('passwordSaveBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Alterando...';

            hidePasswordModalMessages();

            console.log('Tentando alterar senha para cliente:', currentClientId);

            try {
                const response = await fetch(`/api/clients/${currentClientId}/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao alterar senha');
                }

                showPasswordModalSuccess();
                document.getElementById('changePasswordForm').reset();

                // Fechar modal ap√≥s 1.5 segundos
                setTimeout(() => {
                    closeChangePasswordModal();
                }, 1500);

            } catch (error) {
                console.error('Erro ao alterar senha:', error);
                showPasswordModalError(error.message || 'Erro ao alterar senha. Tente novamente.');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Alterar Senha';
            }
        });

        // Fechar modal de senha ao clicar fora
        document.getElementById('changePasswordModal').addEventListener('click', (e) => {
            if (e.target.id === 'changePasswordModal') {
                closeChangePasswordModal();
            }
        });

        // Fun√ß√µes do Menu Mobile
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const btn = document.getElementById('mobileMenuBtn');

            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
            btn.classList.toggle('active');

            // Prevenir scroll do body quando menu est√° aberto
            if (sidebar.classList.contains('mobile-open')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const btn = document.getElementById('mobileMenuBtn');

            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
            btn.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Fechar menu mobile ao clicar em um item do menu
        function showSection(section) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));

            // Mostrar a se√ß√£o selecionada
            const targetSection = document.getElementById('section-' + section);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Atualizar menu items
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Fechar menu mobile se estiver aberto
            if (window.innerWidth <= 768) {
                closeMobileMenu();
            }
        }

        // Redirecionar para login se n√£o tiver cliente
        function goToConfigPanel() {
            if (!currentClientId) {
                window.location.href = '/login';
            }
        }

        // Fun√ß√£o de logout
        function logout() {
            if (confirm('Tem certeza que deseja sair do painel?')) {
                localStorage.removeItem('client_id');
                window.location.href = '/login';
            }
        }

        // Fun√ß√£o para carregar e renderizar o gr√°fico de m√©tricas
        async function loadMetricsChart() {
            try {
                console.log('üîÑ Carregando m√©tricas...');
                // Buscar dados da API (usando cliente ID 1 como exemplo)
                const response = await fetch(`/api/clients/1/metrics?days=7`);
                const data = await response.json();
                console.log('üìä Dados recebidos:', data);

                // Configurar o gr√°fico
                const ctx = document.getElementById('metricsChart').getContext('2d');

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Mensagens',
                            data: data.mensagens,
                            borderColor: '#FF5A5A',
                            backgroundColor: 'rgba(255, 90, 90, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Contatos',
                            data: data.contatos,
                            borderColor: '#25D366',
                            backgroundColor: 'rgba(37, 211, 102, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.8)',
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.6)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.6)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar m√©tricas:', error);
            }
        }

        // Inicializar quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', async () => {
            await init();
            await loadRespostas();
            await loadMenu();
            await loadFluxos();
            await loadIntegracoes();
            await loadMetricsChart();
        });

        function toggleSubmenu(event) {
            event.preventDefault();
            const parentLi = event.target.closest('li.has-submenu');
            parentLi.classList.toggle('open');
        }
    </script>
</body>
</html>
