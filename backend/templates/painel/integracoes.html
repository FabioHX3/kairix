{% extends "base.html" %}

{% block title %}IntegraÃ§Ãµes - Kairix{% endblock %}

{% block content %}
<div class="content-header">
    <h1>ğŸ”Œ IntegraÃ§Ãµes</h1>
    <p>Configure integraÃ§Ãµes com Evolution API e outros serviÃ§os</p>
</div>

<div class="section-card">
    <h3>ğŸš€ Evolution API</h3>
    <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        Configure a conexÃ£o com a Evolution API para envio e recebimento de mensagens WhatsApp
    </p>

    <form id="form-evolution">
        <div class="form-group">
            <label>URL da Evolution API *</label>
            <input type="url" id="evolution-url" placeholder="https://evolution-api.com" required>
            <small>URL base da sua instÃ¢ncia Evolution API</small>
        </div>

        <div class="form-group">
            <label>API Key *</label>
            <input type="text" id="evolution-apikey" placeholder="Sua API Key" required>
            <small>Chave de autenticaÃ§Ã£o da Evolution API</small>
        </div>

        <div class="form-group">
            <label>Nome da InstÃ¢ncia *</label>
            <input type="text" id="evolution-instance" placeholder="Ex: minha-empresa" required>
            <small>Nome da instÃ¢ncia WhatsApp na Evolution API</small>
        </div>

        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn btn-success">ğŸ’¾ Salvar ConfiguraÃ§Ã£o</button>
            <button type="button" class="btn btn-primary" onclick="testEvolutionConnection()">ğŸ” Testar ConexÃ£o</button>
        </div>
    </form>

    <!-- Status da ConexÃ£o -->
    <div id="evolution-status" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; display: none;">
        <h4>Status da ConexÃ£o</h4>
        <div id="evolution-status-content"></div>
    </div>
</div>

<div class="section-card" style="margin-top: 20px;">
    <h3>ğŸ“Š Webhook Configuration</h3>
    <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        Configure o webhook para receber eventos da Evolution API
    </p>

    <div class="form-group">
        <label>URL do Webhook</label>
        <input type="text" id="webhook-url" readonly value="{{ webhook_url }}">
        <small>Use esta URL na configuraÃ§Ã£o da sua Evolution API</small>
    </div>

    <div class="form-group">
        <label>Eventos Monitorados</label>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="event-messages" checked disabled>
                <span>ğŸ“¨ Mensagens (MESSAGES_UPSERT)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="event-connection" checked disabled>
                <span>ğŸ”— Status de ConexÃ£o (CONNECTION_UPDATE)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="event-qrcode" checked disabled>
                <span>ğŸ“± QR Code (QRCODE_UPDATED)</span>
            </label>
        </div>
    </div>

    <button class="btn btn-primary" onclick="refreshWebhookStatus()">ğŸ”„ Verificar Status</button>

    <!-- Log de Webhooks Recentes -->
    <div style="margin-top: 30px;">
        <h4>ğŸ“‹ Webhooks Recentes (Ãšltimas 24h)</h4>
        <div id="webhook-logs" style="margin-top: 15px;">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“­</div>
                <p>Nenhum webhook recebido ainda</p>
            </div>
        </div>
    </div>
</div>

<div class="section-card" style="margin-top: 20px;">
    <h3>ğŸ”§ Outras IntegraÃ§Ãµes</h3>
    <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        IntegraÃ§Ãµes adicionais disponÃ­veis em breve
    </p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        <div style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 2px dashed rgba(255,255,255,0.1);">
            <h4 style="margin: 0 0 10px 0;">ğŸ’³ Pagamentos</h4>
            <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 15px;">
                IntegraÃ§Ã£o com gateways de pagamento
            </p>
            <span style="padding: 5px 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem;">Em Breve</span>
        </div>

        <div style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 2px dashed rgba(255,255,255,0.1);">
            <h4 style="margin: 0 0 10px 0;">ğŸ“§ Email</h4>
            <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 15px;">
                Envio de emails automatizados
            </p>
            <span style="padding: 5px 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem;">Em Breve</span>
        </div>

        <div style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 2px dashed rgba(255,255,255,0.1);">
            <h4 style="margin: 0 0 10px 0;">ğŸ—„ï¸ CRM</h4>
            <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 15px;">
                SincronizaÃ§Ã£o com CRM externo
            </p>
            <span style="padding: 5px 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem;">Em Breve</span>
        </div>

        <div style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 2px dashed rgba(255,255,255,0.1);">
            <h4 style="margin: 0 0 10px 0;">ğŸ“Š Analytics</h4>
            <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 15px;">
                Google Analytics e mÃ©tricas
            </p>
            <span style="padding: 5px 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem;">Em Breve</span>
        </div>
    </div>
</div>

<div class="section-card" style="margin-top: 20px;">
    <h3>â„¹ï¸ InformaÃ§Ãµes Importantes</h3>
    <ul style="color: rgba(255,255,255,0.7); line-height: 1.8;">
        <li>A Evolution API Ã© necessÃ¡ria para o funcionamento do bot WhatsApp</li>
        <li>Certifique-se de que sua instÃ¢ncia Evolution estÃ¡ ativa e conectada</li>
        <li>O webhook deve estar configurado na Evolution API para receber eventos</li>
        <li>Teste a conexÃ£o antes de comeÃ§ar a usar o bot</li>
        <li>Mantenha sua API Key segura e nÃ£o compartilhe com terceiros</li>
    </ul>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadEvolutionConfig();
    loadWebhookUrl();
});
</script>
{% endblock %}
