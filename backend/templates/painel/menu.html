{% extends "base.html" %}

{% block title %}Menu Interativo - Kairix{% endblock %}

{% block content %}
<div class="content-header">
    <h1>ğŸ“± Menu Interativo</h1>
    <p>Configure menus de opÃ§Ãµes para seus clientes</p>
</div>

<div class="preview-grid">
    <!-- Coluna de ConfiguraÃ§Ã£o -->
    <div class="config-column">
        <div class="section-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Configurar Menu</h3>
                <button class="btn btn-success" onclick="saveMenu()">ğŸ’¾ Salvar Menu</button>
            </div>

            <!-- FormulÃ¡rio de Menu -->
            <div class="form-group">
                <label>Mensagem de Boas-Vindas *</label>
                <textarea id="menu-welcome" placeholder="OlÃ¡! Bem-vindo ao nosso atendimento..." rows="3"></textarea>
                <small>Mensagem inicial que o bot enviarÃ¡ junto com o menu</small>
            </div>

            <div class="form-group">
                <label>TÃ­tulo do Menu</label>
                <input type="text" id="menu-title" placeholder="Ex: ğŸ“‹ Menu Principal">
                <small>TÃ­tulo que aparece no topo do menu</small>
            </div>

            <!-- Lista de OpÃ§Ãµes do Menu -->
            <div style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4>OpÃ§Ãµes do Menu</h4>
                    <button class="btn btn-primary" onclick="addMenuOption()">â• Adicionar OpÃ§Ã£o</button>
                </div>

                <div id="menu-options-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <p>Nenhuma opÃ§Ã£o cadastrada</p>
                        <p style="font-size: 0.9rem;">Clique em "Adicionar OpÃ§Ã£o" para comeÃ§ar</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Coluna de Preview -->
    <div class="preview-column">
        <h3>ğŸ“± Preview em Tempo Real</h3>
        <div class="preview-phone">
            <div class="preview-screen">
                <div class="preview-whatsapp-header">
                    <div class="preview-logo-circle"><img src="/logo.png" alt="Logo"></div>
                    <span style="font-weight: 600;">Sua Empresa</span>
                </div>
                <div class="preview-chat" id="preview-chat-menu">
                    <div class="preview-msg preview-msg-bot">OlÃ¡! Bem-vindo ao nosso atendimento.</div>
                    <div class="preview-msg preview-msg-bot">
                        <strong>ğŸ“‹ Menu Principal</strong><br><br>
                        Digite o nÃºmero da opÃ§Ã£o desejada:
                    </div>
                </div>
                <div class="preview-input-box">
                    <input type="text" id="preview-input-menu" placeholder="Digite o nÃºmero..." onkeypress="if(event.key==='Enter') testPreviewMenu()">
                    <button onclick="testPreviewMenu()">â–¶</button>
                </div>
            </div>
        </div>
        <p class="preview-helper-text">ğŸ’¡ Digite nÃºmeros para testar as opÃ§Ãµes</p>
    </div>
</div>

<!-- Modal para Adicionar/Editar OpÃ§Ã£o -->
<div id="modal-menu-option" class="modal">
    <div class="modal-content">
        <h3 id="modal-menu-option-title">Nova OpÃ§Ã£o de Menu</h3>
        <form id="form-menu-option" onsubmit="saveMenuOption(event)">
            <input type="hidden" id="option-index">

            <div class="form-group">
                <label>NÃºmero da OpÃ§Ã£o *</label>
                <input type="text" id="option-number" placeholder="Ex: 1" required>
                <small>NÃºmero que o cliente digitarÃ¡ para selecionar esta opÃ§Ã£o</small>
            </div>

            <div class="form-group">
                <label>Texto da OpÃ§Ã£o *</label>
                <input type="text" id="option-text" placeholder="Ex: ğŸ“¦ Ver Produtos" required>
                <small>Texto que aparecerÃ¡ no menu</small>
            </div>

            <div class="form-group">
                <label>Tipo de Resposta *</label>
                <select id="option-type" onchange="toggleResponseType()">
                    <option value="text">Texto Simples</option>
                    <option value="submenu">Submenu</option>
                    <option value="transfer">Transferir para Atendente</option>
                </select>
            </div>

            <div class="form-group" id="option-response-group">
                <label>Resposta *</label>
                <textarea id="option-response" placeholder="Digite a resposta que serÃ¡ enviada..." rows="4"></textarea>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="btn btn-success">ğŸ’¾ Salvar</button>
                <button type="button" class="btn btn-secondary" onclick="closeMenuOptionModal()">âŒ Cancelar</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadMenu();
});
</script>
{% endblock %}
