{% extends "base.html" %}

{% block title %}Conex√£o WhatsApp - Kairix{% endblock %}

{% block content %}
<div class="content-header">
    <h1>üì± Conex√£o WhatsApp</h1>
    <p>Configure o n√∫mero onde o bot ser√° instalado</p>
</div>

<div class="section-card">
    <h3>Dados de Conex√£o</h3>
    <form id="form-conexao">
        <div class="form-group">
            <label>N√∫mero WhatsApp Business *</label>
            <input type="text" id="numero_whatsapp" placeholder="(65) 99934-2690" value="{{ config.numero_whatsapp | default('') }}" required>
            <small>Este n√∫mero ser√° usado para instalar o bot. Certifique-se que √© uma conta Business.</small>
        </div>
        <button type="submit" class="btn btn-success">üíæ Salvar Conex√£o</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Carregar dados de conex√£o ao iniciar
document.addEventListener('DOMContentLoaded', function() {
    loadConfig();
});

// Submeter formul√°rio de conex√£o
document.getElementById('form-conexao').addEventListener('submit', async function(e) {
    e.preventDefault();

    const numeroWhatsapp = document.getElementById('numero_whatsapp').value;

    try {
        const response = await fetchAuth(`/api/orders/${orderId}/config`, {
            method: 'PUT',
            body: JSON.stringify({
                numero_whatsapp: numeroWhatsapp
            })
        });

        if (response.ok) {
            showNotification('success', 'Conex√£o salva com sucesso!');
        } else {
            showNotification('error', 'Erro ao salvar conex√£o');
        }
    } catch (error) {
        console.error('Erro:', error);
        showNotification('error', 'Erro ao salvar conex√£o');
    }
});
</script>
{% endblock %}
